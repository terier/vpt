#!/usr/bin/env node

const fs = require('fs');

const files = [
    'mitos.bvp',
    'fibers.bvp',
    'shards.bvp',
    'manix.bvp',
];

const orientations = new Array(10).fill(0).map(_ => [
    Math.acos(Math.random() * 2 - 1),
    Math.random() * Math.PI * 2,
    0,
]);

const renderers = [
    {
        type: 'mip',
        settings: {
            steps: 256,
        },
    },
    {
        type: 'iso',
        settings: {
            steps: 256,
        },
    },
    {
        type: 'eam',
        settings: {
            extinction: 100,
            slices: 1024,
        },
    },
    {
        type: 'dos',
        settings: {
            extinction: 100,
            slices: 1024,
            steps: 1024,
        },
    },
    {
        type: 'mcm',
        settings: {
            extinction: 100,
            steps: 64,
        },
    },
];

const tonemappers = [
    {
        type: 'artistic',
        settings: {
            gamma: 1,
        },
    },
];

const cameras = [
    {
        near: 1,
        far: 5,
        zoomFactor: 0.0003,
    },
    {
        near: 1,
        far: 5,
        zoomFactor: 0.0004,
    },
];

function cartesian(...lists) {
    if (lists.length === 0) {
        return [];
    } else if (lists.length === 1) {
        return lists[0];
    } else if (lists.length === 2) {
        return lists[0].flatMap(x => lists[1].map(y => [x, y]));
    } else {
        const recursive = cartesian(...lists.slice(1));
        return lists[0].flatMap(x => recursive.map(y => [x, ...y]));
    }
}

const tests = cartesian(
    files,
    orientations,
    renderers,
    tonemappers,
).map(([
    file,
    orientation,
    renderer,
    tonemapper,
]) => ({
    fileName: file,
    fileType: file === 'manix.bvp' ? 'normal' : 'conductor',
    translation: [0, 0, 0],
    rotation: orientation,
    scale: file === 'fibers.bvp' ? [1, 1, 2] : [1, 1, 1],
    renderer: renderer.type,
    rendererSettings: renderer.settings,
    tonemapper: tonemapper.type,
    tonemapperSettings: tonemapper.settings,
    cameraSettings: file === 'fibers.bvp' ? cameras[1] : cameras[0],
    frameTime: renderer.type === 'mcm' ? 30 : 0.2,
    resolution: 1024,
}));

console.log(JSON.stringify(tests, true, 2));
